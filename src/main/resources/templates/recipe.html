<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   <link rel="stylesheet" href="/css/Site.css">
    <title>Рецепт</title>
</head>
<body>
   <header id="header">
        <div id="service-name" class="div-btn">Recipes</div>
        
        <a id="recipe-back-link"><div class="div-btn">Вернуться назад</div></a>
   </header>

   <div id="recipe-container"></div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script th:inline="javascript">
    function getUsername(){
        return [[${username}]];    
    }
    function getToken(){
        return [[${token}]];
    }
    function isAdmin(){
        return [[${isAdmin}]];
    }
    function getRecipeName(){
        return [[${recipeName}]];
    }

    function cameFrom(){
        return [[${from}]];
    }

    $.ajax({
        type: "post",
        url: "/loadRecipe",
        data: "recipeName=" + getRecipeName(),
        success: function (response){
            let container = document.getElementById("recipe-container");
            if (response.status === "SUCCESS"){
                let recipe = response.result;
                let data = JSON.parse(recipe.data);
                container.innerHTML = "";
                container.innerHTML += `
                    <img src="../img/${data.imageName}"><br>
                    <h1>${recipe.name}</h4><br>
                    <h4>Имя создателя - <a href="/user?token=${getToken()}&username=${recipe.creatorName}">${recipe.creatorName}</a></h4><br>
                    <div class="btn btn-outline-danger" onclick="deleteRecipeByName('${recipe.name}')">Удалить рецепт</div>
                    <div style="display: flex; width: 700px; justify-content: space-between">
                        <p style="width:max-content">Просмотры - ${recipe.views}</p>
                        <p style="width:max-content">Лайки - ${recipe.likes}</p>
                        <p style="width:max-content">Комментарии - ${recipe.comments}</p>
                    </div>
                `;
                let ingredients = JSON.parse(data.ingredients);
                let ing_keys = Object.keys(ingredients);
                container.innerHTML += "<h2>Ингредиенты</h2>";
                for(let key of ing_keys){
                    container.innerHTML += `<br><p>${key} - ${ingredients[key]}</p>`;
                }
                let parsedSteps = data.description.split("\\");

                container.innerHTML += "<h2>Шаги приготовления</h2>";

                for (let i = 0; i < parsedSteps.length; i++){
                    container.innerHTML += `<br><h3>Шаг ${i + 1}</h3><br><p>${parsedSteps[i]}</p><br>`;
                }

            }
            else{
                container.innerHTML = `Не удалось загрузить рецепт "${getRecipeName()}"`;
            }
        },
        error: function (e){
            console.log(e);
        }
    });
</script>
<script src="/js/scripts.js"></script>
</body>
</html>